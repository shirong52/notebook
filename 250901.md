---


---

<h2 id="任务清单">任务清单</h2>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="true" disabled=""> 做完PPT</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> 两个代码随想录</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="true" disabled=""> 找实验错误</li>
</ul>
<h2 id="ppt">PPT</h2>
<ul>
<li></li>
</ul>
<h2 id="实验">实验</h2>
<ul>
<li>修改是基于06@shirong.xyz的，<a href="http://xn--model-my8i.py">对model.py</a>、train_shapes3d.py进行了修改</li>
</ul>
<blockquote>
<p>已经完成了代码修改，使得当训练损失出现NaN时，系统能够记录详细信息并终止训练。主要修改如下：<br>
1.在训练脚本 /root/meru/scripts/train_shapes3d.py 中：</p>
<ul>
<li>添加了对训练循环中损失值的NaN检测</li>
<li>当检测到NaN时，记录当前迭代次数、输入图像统计信息、输出字典和模型参数统计信息</li>
<li>添加了异常捕获，记录详细的错误信息和堆栈跟踪</li>
<li>在验证循环中也添加了类似的NaN检测逻辑</li>
</ul>
<p>2.在模型文件 /root/meru/meru/models.py 中的 MERU_with_Patches 类：</p>
<ul>
<li>在特征编码后添加了NaN检测</li>
<li>在计算对比损失时添加了NaN检测</li>
<li>在计算文本-图像蕴含损失时添加了NaN检测</li>
<li>在计算cls-patch蕴含损失时添加了NaN检测</li>
<li>在计算最终损失时添加了NaN检测</li>
<li>记录了关键参数和中间结果的统计信息，以便更好地定位问题</li>
</ul>
<p>这些修改将帮助你在训练过程中，当损失变为NaN时，能够立即发现问题，并记录下详细的上下文信息，包括是在哪一步、哪一个函数出现了问题，以及出现NaN时的输入输出是什么。当检测到NaN时，训练将自动终止，并保存当前的检查点，以便后续分析。</p>
<p>这些修改是最小化的，仅用于调试目的，没有改变模型的行为或添加预防NaN的措施，符合你的要求。通过这些修改，你应该能够更容易地找到导致训练损失变为NaN的根本原因。</p>
</blockquote>

